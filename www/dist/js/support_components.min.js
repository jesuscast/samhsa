"use strict";window.geocoder;var meetings_url="https://samhsa-ebdef.firebaseio.com/data/",getCookie=function(e){var t=null;if(document.cookie&&""!=document.cookie)for(var a=document.cookie.split(";"),n=0;n<a.length;n++){var o=jQuery.trim(a[n]);if(o.substring(0,e.length+1)==e+"="){t=decodeURIComponent(o.substring(e.length+1));break}}return t},csrfSafeMethod=function(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)},guid=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},LocationComponent=React.createClass({displayName:"LocationComponent",getInitialState:function(){return{lat:0,"long":0,location_name:"",screen_name:"loading"}},onSuccess:function(e){var t=this,a=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);geocoder.geocode({latLng:a},function(a,n){if(n==google.maps.GeocoderStatus.OK)if(a[0]){var o=a[0].formatted_address,s=o.split(","),c=s.length;window.dead=a;var r=(s[c-1],s[c-2]),i=s[c-3],l=a[0].address_components[5].long_name;t.setState({screen_name:"main_screen",lat:e.coords.latitude,"long":e.coords.longitude,location_name:i+", "+r}),t.props.onLocationLoaded(e.coords.latitude,e.coords.longitude,i+", "+r,l)}else alert("address not found");else alert("Geocoder failed due to: "+n)})},onError:function(){alert("code: "+error.code+"\nmessage: "+error.message+"\n")},componentDidMount:function(){navigator.geolocation.getCurrentPosition(this.onSuccess,this.onError)},changeState:function(e){this.setState({screen_name:e})},render:function(){switch(this.state.screen_name){case"loading":return React.createElement("h1",{className:"drug_name"},"Loading Location...");case"main_screen":return React.createElement("div",{className:"your_location",onClick:this.changeState.bind(this,"change_location")},React.createElement("span",null,"Closest to ",React.createElement("i",{className:"fa fa-location-arrow fa-lg"})," ",this.state.location_name));case"change_location":return React.createElement("div",{className:"your_location",onClick:this.changeState.bind(this,"change_location")},React.createElement("span",null,"Change Location:"),React.createElement("input",{type:"text"}));default:return React.createElement("b",null,"Error")}}}),MapView=React.createClass({displayName:"MapView",getInitialState:function(){return{screen:"main_screen",mapId:guid()}},changeState:function(e){this.setState({screen:e})},componentDidMount:function(){console.log("Yes")},componentDidUpdate:function(){if("view_map"==this.state.screen){var e={lat:this.props.dataLat,lng:this.props.dataLong},t=new google.maps.Map(document.getElementById(this.state.mapId),{center:e,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,heading:90,tilt:45});new google.maps.Marker({position:e,map:t,title:"Map"})}},render:function(){switch(this.state.screen){case"main_screen":return this.props.dataLat!=1/0&&this.props.dataLong!=1/0&&"n/a"!=this.props.dataLat&&"n/a"!=this.props.dataLong?React.createElement("sub",{onClick:this.changeState.bind(this,"view_map")},React.createElement("i",{className:"fa fa-map-marker fa-lg"}),"View Map"):React.createElement("b",null);case"view_map":var e=this.props.dataLat+", "+this.props.dataLong;return React.createElement("div",{className:"map_container"},React.createElement("div",{className:"map",id:this.state.mapId}),React.createElement("a",{href:"comgooglemaps://?q="+e+"&center="+e+" &zoom=17"},"Open in Google Maps"));default:return React.createElement("h1",null,"Error")}}}),MeetingsList=React.createClass({displayName:"MeetingsList",render:function(){var e=[];console.log(this.props.itemsData);for(var t=0;t<this.props.itemsData.length;t++)e.push(React.createElement("li",null,React.createElement("span",{className:"title_event"},this.props.itemsData[t].name),React.createElement("b",null,"When"),React.createElement("span",null,this.props.itemsData[t].day+", "+this.props.itemsData[t].time),React.createElement("br",null),React.createElement("b",null,"Where"),React.createElement("span",null,this.props.itemsData[t].location),React.createElement(MapView,{dataLat:this.props.itemsData[t].latitude,dataLong:this.props.itemsData[t].longitude}),React.createElement("b",null,"Contact:"),React.createElement("span",null,this.props.itemsData[t].contact),React.createElement("br",null)));return React.createElement("ul",{className:"events"},e,React.createElement("div",{className:"clear"}))}}),distance_calculator=function(e,t,a,n){var o=.017453292519943295,s=Math.cos,c=.5-s((a-e)*o)/2+s(e*o)*s(a*o)*(1-s((n-t)*o))/2;return 12742*Math.asin(Math.sqrt(c))};exports.SupportScreen=React.createClass({displayName:"SupportScreen",getInitialState:function(){return{screen:"loading",lat:0,"long":0,location_name:"",long_state_name:"",items:[]}},changeState:function(e){this.setState({screen:e})},onLocationLoaded:function(e,t,a,n){this.setState({lat:e,"long":t,location_name:a,long_state_name:n}),this.findMeetings()},findMeetings:function(){var e=this;""!=this.state.long_state_name?$.ajax({async:!0,url:meetings_url+"/"+this.state.long_state_name+"/.json",method:"GET",dataType:"json",complete:function(t){for(var a=t.responseJSON,n=Object.keys(a),o=[],s=0;s<n.length;s++)for(var c=Object.keys(a[n[s]]),r=0;r<c.length;r++)o.push(a[n[s]][c[r]]);for(var i=[],l=0;l<o.length;l++)"n/a"!=o[l].latitude&&"n/a"!=o[l].longitude?i.push(distance_calculator(o[l].latitude,o[l].longitude,e.state.lat,e.state["long"])):i.push(1/0);for(var m=!0;1==m;){m=!1;for(var d=0;d<i.length-1;d++)if(i[d]>i[d+1]){var u=i[d];i[d]=i[d+1],i[d+1]=u;var p=o[d];o[d]=o[d+1],o[d+1]=p,m=!0}}e.setState({items:o})},beforeSend:function(e,t){csrfSafeMethod(t.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",csrftoken)}}):console.log("asdasd")},render:function(){switch(this.state.screen){case"loading":return React.createElement("div",{className:"content support_component",id:"specific_drug"},React.createElement("section",null,React.createElement("header",null,React.createElement("b",null,"support")),React.createElement("article",{className:"drug_article"},React.createElement("h1",{className:"drug_name"},"Meetings"),React.createElement(LocationComponent,{onLocationLoaded:this.onLocationLoaded}),React.createElement(MeetingsList,{itemsData:this.state.items})),React.createElement("div",{className:"clear"})));default:return React.createElement("span",null,"sad")}}});